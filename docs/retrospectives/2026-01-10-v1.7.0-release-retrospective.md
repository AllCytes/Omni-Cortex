# Retrospective: v1.7.0 Release & Documentation Update
Date: 2026-01-10

## Summary
This retrospective covers two sessions: the v1.7.0 release session (dashboard stats fix + ADW system recreation) and the follow-up documentation session (README Getting Started guide + this retrospective).

**Key Accomplishments:**
- Fixed dashboard statistics not populating
- Recreated entire ADW system (16 files, 1221 lines)
- Released v1.7.0 to PyPI and GitHub
- Added beginner-friendly Getting Started guide to README
- Ran comprehensive retrospective analysis

## Errors Encountered

| Error | Cause | Resolution | Prevention |
|-------|-------|------------|------------|
| Dashboard stats charts empty | `post_tool_use.py` not populating `command_name`, `skill_name`, `mcp_server` columns | Added `extract_skill_info()`, `extract_mcp_server()`, `ensure_analytics_columns()` helper functions | Test hook changes by generating activities and checking database |
| ADW files missing | Files were in `.gitignore` and accidentally reverted | Recreated entire ADW module structure from scratch | Keep ADW in separate repo or remove from .gitignore |
| Session ID NULL issue (v1.6.0) | Hooks read `CLAUDE_SESSION_ID` env var that Claude Code doesn't set | Added session file persistence in `.omni-cortex/current_session.json` | Always test env var assumptions |
| TypeScript duplicate types | `ActivityDetail` defined in both `types/index.ts` AND `services/api.ts` | Updated both files; prefer `extends` pattern | Grep for type names before modifying |
| pydantic-core import failure | Corrupted venv metadata after UV operations | `uv pip install pydantic --force-reinstall` | Add venv health check to /build |
| Schema column missing in tests | Only updated migrations.py, not schema.py | Update BOTH schema.py (new DBs) AND migrations.py (existing DBs) | Document schema + migration pattern |

## Snags & Blockers

1. **ADW System Complete Rewrite**
   - Impact: 2+ hours to recreate from memory
   - Resolution: Rebuilt based on IndyDevDan patterns and session memories
   - Root cause: Personal/experimental code was in .gitignore

2. **Dashboard Project Context Confusion**
   - Impact: Validation showed wrong data
   - Resolution: Switch project selector to "omni-cortex" instead of "Global Index"
   - Root cause: Dashboard defaults to global view

3. **Hook Code Duplication**
   - Impact: Same session logic duplicated in pre_tool_use.py and post_tool_use.py
   - Resolution: Created shared `hooks/session_utils.py` module
   - Root cause: Hooks developed independently without DRY consideration

## Lessons Learned

### Technical Lessons
1. **`pip install -e .` only runs once** - Creates symlink to source, subsequent code changes are immediate
2. **Hooks run as subprocesses** - File changes take effect on next tool call without restart
3. **MCP tools not logged** - `cortex_*` tools intentionally skip logging to prevent recursion
4. **Dashboard needs NEW activities** - Fixing hook code doesn't backfill; charts need new data with populated fields
5. **Double schema updates** - Schema changes require both base schema.py AND migrations.py updates

### Process Lessons
1. **Check BOTH hooks** - When fixing pre_tool_use.py, also check post_tool_use.py for similar issues
2. **Test hook changes** - Generate test activities and verify columns in database directly
3. **Verify project context** - Before dashboard validation, confirm project selector shows correct project
4. **Session persistence works** - Using `.omni-cortex/current_session.json` for cross-invocation state is reliable
5. **Store session summaries** - Using cortex_remember for session handoff is highly effective

### Documentation Lessons
1. **Beginners need expected outputs** - Show what successful commands look like
2. **Collapsible troubleshooting** - HTML `<details>` tags keep README clean while providing help
3. **Platform-specific paths** - Include both Windows and Unix path examples

## Command Improvements

| Command | Change Made |
|---------|-------------|
| `/validate` | Added "Verify Project Context" step to ensure correct database selected |
| `/build` | Consider adding venv health check before tests |
| `/dev-setup` | Created but kept in .gitignore (project-specific) |

## Process Improvements

### Recommended for Future Sessions
1. **Pre-session checklist**
   - [ ] `cortex_recall` for previous session summary
   - [ ] Verify correct project in dashboard
   - [ ] Check for pending TODOs from last session

2. **Post-hook-change checklist**
   - [ ] Test hook by generating activity
   - [ ] Check database columns directly
   - [ ] Verify both pre_tool_use.py and post_tool_use.py if relevant

3. **Schema change checklist**
   - [ ] Update src/omni_cortex/database/schema.py
   - [ ] Add migration in src/omni_cortex/database/migrations.py
   - [ ] Update dashboard/backend/database.py if dashboard uses schema
   - [ ] Run tests to verify

4. **Release checklist (enhanced)**
   - [ ] All tests pass
   - [ ] Version bumped in pyproject.toml
   - [ ] Clean dist/ folder
   - [ ] Build with `uv build`
   - [ ] Upload specific version files to PyPI
   - [ ] Push to GitHub
   - [ ] Store session summary in memory

## Metrics

| Metric | Value |
|--------|-------|
| Tasks Completed | 12 |
| Errors Encountered | 6 |
| Errors Resolved | 6 (100%) |
| Files Modified | 25+ |
| Lines Added | 1500+ |
| Version Released | 1.7.0 |
| Retrospectives in Memory | 7 |
| Chrome MCP Screenshots | 8 |
| Time on Issues vs Productive | 35% / 65% |

## Files Created This Session

- `docs/ADW-Guide.md` - Comprehensive ADW usage guide
- `hooks/session_utils.py` - Shared session management module
- `adws/` directory (16 files) - Complete ADW system
- README.md Getting Started section - Beginner-friendly setup guide
- This retrospective

## Recommendations

### Immediate Actions
1. **Add ADW to main repo** - Remove from .gitignore or create separate omni-cortex-adw repo
2. **Backfill dashboard stats** - Create script to populate analytics columns for existing activities
3. **Add integration tests for hooks** - Test that hooks populate all expected columns

### Future Improvements
1. **Auto-session detection** - Consider detecting session changes from Claude Code somehow
2. **Dashboard auto-project selection** - Remember last selected project in localStorage
3. **Hook testing tool** - Create `/test-hooks` command that generates test activities and verifies columns

---
*Generated by /retrospective skill*
*Session memories: 118 total, 20 from past 24 hours*
